<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https:&#x2F;&#x2F;eips.ethereum.com&#x2F;minima.css">

        <!-- opengraph -->
        <meta property="og:locale" content="en_US" />
        <meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.com" />
        <meta property="og:site_name" content="Ethereum Improvement Proposals" />

        <!-- twitter -->
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@ethereum" />

        <script type="application/ld+json">
            {
              "@type": "WebSite",
              "url": "https:&#x2F;&#x2F;eips.ethereum.com",
              "name": "Ethereum Improvement Proposals",
              "description": "Description",
              "@context": "https://schema.org"
            }
        </script>

        

        

<title>EIP-1444: Localized Messaging with Signal-to-Text</title>
<link rel="canonical" href="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-1444.md" />
<meta property="og:title" content="EIP-1444: Localized Messaging with Signal-to-Text" />
<meta
    name="description"
    content="Details on Ethereum Improvement Proposal 1444 (EIP-1444): Localized Messaging with Signal-to-Text"
/>
<meta
    property="og:description"
    content="Details on Ethereum Improvement Proposal 1444 (EIP-1444): Localized Messaging with Signal-to-Text"
/>
<meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-1444.md" />
<meta name="twitter:description" content="Details on Ethereum Improvement Proposal 1444 (EIP 1444): Localized Messaging with Signal-to-Text" />

    </head>
    <body>
        <header class="site-header">
            <div class="wrapper">
                <a class="site-title" rel="author" href="https:&#x2F;&#x2F;eips.ethereum.com">Ethereum Improvement Proposals</a>
                <nav class="site-nav">
                    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
                    <label for="nav-trigger">
                        <span class="menu-icon">
                            <svg viewBox="0 0 18 15" width="18px" height="15px">
                                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
                            </svg>
                        </span>
                    </label>

                    <div class="trigger">
                        
                            <a class="page-link" href="&#x2F;all">All</a>
                        
                            <a class="page-link" href="&#x2F;core">Core</a>
                        
                            <a class="page-link" href="&#x2F;networking">Networking</a>
                        
                            <a class="page-link" href="&#x2F;interface">Interface</a>
                        
                            <a class="page-link" href="&#x2F;erc">ERC</a>
                        
                            <a class="page-link" href="&#x2F;meta">Meta</a>
                        
                            <a class="page-link" href="&#x2F;informational">Informational</a>
                        
                    </div>
                </nav>
            </div>
        </header>
        <main class="page-content" aria-label="Content">
            <div class="wrapper">
                
<div class="home">
    <h1 class="page-heading">
        EIP-1444: Localized Messaging with Signal-to-Text
        <a href=""><svg role="img" aria-label="Source" xmlns="https://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><title>Source</title><path fill-rule="evenodd" d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"/></svg></a>
    </h1>
    <table>
        <tr>
            <th>Author</th>
            <td>
    
        
        
            <a href="https://github.com/expede">Brooklyn Zelenka</a>,
        
    
        
        
            <a href="https://github.com/jenncoop"> Jennifer Cooper</a>
        
    
</td>
        </tr>

        
          <tr>
              <th>Discussions-To</th>
              <td><a href="https:&#x2F;&#x2F;ethereum-magicians.org&#x2F;t&#x2F;eip-1444-localized-messaging-with-signal-to-text&#x2F;">https:&#x2F;&#x2F;ethereum-magicians.org&#x2F;t&#x2F;eip-1444-localized-messaging-with-signal-to-text&#x2F;</a></td>
          </tr>
        

        <tr>
            <th>Status</th>
            <td>
                Draft
                
            </td>
        </tr>

        <tr>
            <th>Type</th>
            <td>Standards Track</td>
        </tr>

        
          <tr>
              <th>Category</th>
              <td>ERC</td>
          </tr>
        

        <tr>
            <th>Created</th>
            <td>2018-09-23</td>
        </tr>

        

        

        

        

        
  </table>

  
    <h2 id="simple-summary">Simple Summary</h2>
<p>A method of converting machine codes to human-readable text in any language and phrasing.</p>
<h2 id="abstract">Abstract</h2>
<p>An on-chain system for providing user feedback by converting machine-efficient codes into human-readable strings in any language or phrasing. The system does not impose a list of languages, but rather lets users create, share, and use the localizated text of their choice.</p>
<h2 id="motivation">Motivation</h2>
<p>There are many cases where an end user needs feedback or instruction from a smart contact. Directly exposing numeric codes does not make for good UX or DX. If Ethereum is to be a truly global system usable by experts and lay persons alike, systems to provide feedback on what happened during a transaction are needed in as many languages as possible.</p>
<p>Returning a hard-coded string (typically in English) only serves a small segment of the global population. This standard proposes a method to allow users to create, register, share, and use a decentralized collection of translations, enabling richer messaging that is more culturally and linguistically diverse.</p>
<p>There are several machine efficient ways of representing intent, status, state transition, and other semantic signals including booleans, enums and <a href="https://eips.ethereum.org/EIPS/eip-1066">ERC-1066 codes</a>. By providing human-readable messages for these signals, the developer experience is enhanced by returning easier to consume information with more context (ex. <code>revert</code>). End user experience is enhanced by providing text that can be propagated up to the UI.</p>
<h2 id="specification">Specification</h2>
<h3 id="contract-architecture">Contract Architecture</h3>
<p>Two types of contract: <code>LocalizationPreferences</code>, and <code>Localization</code>s.</p>
<p>The <code>LocalizationPreferences</code> contract functions as a proxy for <code>tx.origin</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">                                                                   +--------------+
                                                                   |              |
                                                          +------&gt; | Localization |
                                                          |        |              |
                                                          |        +--------------+
                                                          |
                                                          |
+-----------+          +-------------------------+        |        +--------------+
|           |          |                         | &lt;------+        |              |
| Requestor | &lt;------&gt; | LocalizationPreferences | &lt;-------------&gt; | Localization |
|           |          |                         | &lt;------+        |              |
+-----------+          +-------------------------+        |        +--------------+
                                                          |
                                                          |
                                                          |        +--------------+
                                                          |        |              |
                                                          +------&gt; | Localization |
                                                                   |              |
                                                                   +--------------+
</span></code></pre><h3 id="localization"><code>Localization</code></h3>
<p>A contract that holds a simple mapping of codes to their text representations.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">interface Localization {
  function textFor(bytes32 _code) external view returns (string _text);
}
</span></code></pre><h4 id="textfor"><code>textFor</code></h4>
<p>Fetches the localized text representation.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function textFor(bytes32 _code) external view returns (string _text);
</span></code></pre><h3 id="localizationpreferences"><code>LocalizationPreferences</code></h3>
<p>A proxy contract that allows users to set their preferred <code>Localization</code>. Text lookup is delegated to the user's preferred contract.</p>
<p>A fallback <code>Localization</code> with all keys filled MUST be available. If the user-specified <code>Localization</code> has not explicitly set a loalization (ie. <code>textFor</code> returns <code>&quot;&quot;</code>), the <code>LocalizationPreferences</code> MUST redelegate to the fallback <code>Localization</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">interface LocalizationPreferences {
  function set(Localization _localization) external returns (bool);
  function textFor(bytes32 _code) external view returns (bool _wasFound, string _text);
}
</span></code></pre><h4 id="set"><code>set</code></h4>
<p>Registers a user's preferred <code>Localization</code>. The registering user SHOULD be considered <code>tx.origin</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function set(Localization _localization) external;
</span></code></pre><h4 id="textfor-1"><code>textFor</code></h4>
<p>Retrieve text for a code found at the user's preferred <code>Localization</code> contract.</p>
<p>The first return value (<code>bool _wasFound</code>) represents if the text is available from that <code>Localization</code>, or if a fallback was used. If the fallback was used in this context, the <code>textFor</code>'s first return value MUST be set to <code>false</code>, and is <code>true</code> otherwise.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function textFor(bytes32 _code) external view returns (bool _wasFound, string _text);
</span></code></pre><h3 id="string-format">String Format</h3>
<p>All strings MUST be encoded as <a href="https://www.ietf.org/rfc/rfc3629.txt">UTF-8</a>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">&quot;≈†peƒâi√§l ch√¢r√£√ßt√©rs are permitted&quot;
&quot;As are non-Latin characters: „Ç¢„É´„ÉüÁº∂„ÅÆ‰∏ä„Å´„ÅÇ„Çã„Åø„Åã„Çì„ÄÇ&quot;
&quot;Emoji are legal: üôàüôâüôäüéâ&quot;
&quot;Feel free to be creative: (Ôæâ‚óï„ÉÆ‚óï)Ôæâ*:ÔΩ•Ôæü‚úß&quot;
</span></code></pre><h3 id="templates">Templates</h3>
<p>Template strings are allowed, and MUST follow the <a href="https://pubs.opengroup.org/onlinepubs/009696799/utilities/printf.html">ANSI C <code>printf</code></a> conventions.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">&quot;Satoshi&#39;s true identity is %s&quot;
</span></code></pre>
<p>Text with 2 or more arguments SHOULD use the POSIX parameter field extension.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">&quot;Knock knock. Who&#39;s there? %1$s. %1$s who? %2$s!&quot;
</span></code></pre><h2 id="rationale">Rationale</h2>
<h3 id="bytes32-keys"><code>bytes32</code> Keys</h3>
<p><code>bytes32</code> is very efficient since it is the EVM's base word size. Given the enormous number of elements (card(A) &gt; 1.1579 √ó 10<sup>77</sup>), it can embed nearly any practical signal, enum, or state. In cases where an application's key is longer than <code>bytes32</code>, hashing that long key can map that value into the correct width.</p>
<p>Designs that use datatypes with small widths than <code>bytes32</code> (such as <code>bytes1</code> in <a href="https://eips.ethereum.org/EIPS/eip-1066">ERC-1066</a>) can be directly embedded into the larger width. This is a trivial one-to-one mapping of the smaller set into the the larger one.</p>
<h3 id="local-vs-globals-and-singletons">Local vs Globals and Singletons</h3>
<p>This spec has opted to not <em>force</em> a single global registry, and rather allow any contract and use case deploy their own system. This allows for more flexibility, and does not restrict the community for opting to use singleton <code>LocalizationPreference</code> contracts for common use cases, share <code>Localization</code>s between different proxys, delegate translations between <code>Localization</code>s, and so on.</p>
<p>There are many practical uses of agreed upon singletons. For instance, translating codes that aim to be fairly universal and integrated directly into the broader ecosystem (wallets, frameworks, debuggers, and the like) will want to have a single <code>LocalizationPreference</code>.</p>
<p>Rather the dispersing several <code>LocalizationPreference</code>s for different use cases and codes, one could imagine a global &quot;registry of registries&quot;. While this approach allows for a unified lookups of all translations in all use cases, it is antithetical to the spirit of decentralization and freedom. Such a system also increases the lookup complexity, places an onus on getting the code right the first time (or adding the overhead of an upgradable contract), and need to account for use case conflicts with a &quot;unified&quot; or centralized numbering system. Further, lookups should be lightweight (especially in cases like looking up revert text).</p>
<p>For these reasons, this spec chooses the more decentralized, lightweight, free approach, at the cost of on-chain discoverability. A registry could still be compiled, but would be difficult to enforce, and is out of scope of this spec.</p>
<h3 id="off-chain-storage">Off Chain Storage</h3>
<p>A very viable alternative is to store text off chain, with a pointer to the translations on-chain, and emit or return a <code>bytes32</code> code for another party to do the lookup. It is difficult to guarantee that off-chain resources will be available, and requires coordination from some other system like a web server to do the code-to-text matching. This is also not compatible with <code>revert</code> messages.</p>
<h3 id="ascii-vs-utf-8-vs-utf-16">ASCII vs UTF-8 vs UTF-16</h3>
<p>UTF-8 is the most widely used encoding at time of writing. It contains a direct embedding of ASCII, while providing characters for most natural languages, emoji, and special characters.</p>
<p>Please see the <a href="https://utf8everywhere.org/">UTF-8 Everywhere Manifesto</a> for more information.</p>
<h3 id="when-no-text-is-found">When No Text is Found</h3>
<p>Returning a blank string to the requestor fully defeats the purpose of a localization system. The two options for handling missing text are:</p>
<ol>
<li>A generic &quot;text not found&quot; message in the preferred language</li>
<li>The actual message, in a different language</li>
</ol>
<h4 id="generic-option">Generic Option</h4>
<p>This designed opted to not use generic fallback text. It does not provide any useful information to the user other than to potentially contact the <code>Localization</code> maintainer (if one even exists and updating is even possible).</p>
<h4 id="fallback-option">Fallback Option</h4>
<p>The design outlined in this proposal is to providing text in a commonly used language (ex. English or Mandarin). First, this is the language that will be routed to if the user has yet to set a preference. Second, there is a good chance that a user may have <em>some</em> proficiency with the language, or at least be able to use an automated translation service.</p>
<p>Knowing that the text fell back via <code>textFor</code>s first return field boolean is <em>much</em> simpler than attempting language detection after the fact. This information is useful for certain UI cases. for example where there may be a desire to explain why localization fell back.</p>
<h3 id="decentralized-text-crowdsourcing">Decentralized Text Crowdsourcing</h3>
<p>In order for Ethereum to gain mass adoption, users must be able to interact with it in the language, phrasing, and level of detail that they are most comfortable with. Rather than imposing a fixed set of translations as in a traditional, centralized application, this EIP provides a way for anyone to create, curate, and use translations. This empowers the crowd to supply culturally and linguistically diverse messaging, leading to broader and more distributed access to information.</p>
<h3 id="printf-style-format-strings"><code>printf</code>-style Format Strings</h3>
<p>C-style <code>printf</code> templates have been the de facto standard for some time. They have wide compatibility across most languages (either in standard or third-party libraries). This makes it much easier for the consuming program to interpolate strings with low developer overhead.</p>
<h4 id="parameter-fields">Parameter Fields</h4>
<p>The POSIX parameter field extension is important since languages do not share a common word order. Parameter fields enable the reuse and rearrangement of arguments in different localizations.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">(&quot;%1$s is an element with the atomic number %2$d!&quot;, &quot;Mercury&quot;, 80);
// =&gt; &quot;Mercury is an element with the atomic number 80!&quot;
</span></code></pre><h4 id="simplified-localizations">Simplified Localizations</h4>
<p>Localization text does not require use of all parameters, and may simply ignore values. This can be useful for not exposing more technical information to users that would otherwise find it confusing.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#65737e;">#!/usr/bin/env ruby

</span><span style="color:#96b5b4;">sprintf</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#d08770;">%1$s</span><span style="color:#a3be8c;"> √© um elemento</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">Mercurio</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">80</span><span style="color:#c0c5ce;">)
</span><span style="color:#65737e;"># =&gt; &quot;Mercurio √© um elemento&quot;
</span></code></pre><pre style="background-color:#2b303b;">
<code><span style="color:#65737e;">#!/usr/bin/env clojure

(format &quot;Element #%2$s&quot; &quot;Mercury&quot; 80)
;; =&gt; Element #80
</span></code></pre><h3 id="interpolation-strategy">Interpolation Strategy</h3>
<p>Please note that it is highly advisable to return the template string <em>as is</em>, with arguments as multiple return values or fields in an <code>event</code>, leaving the actual interpolation to be done off chain.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event AtomMessage {
  bytes32 templateCode;
  bytes32 atomCode;
  uint256 atomicNumber;
}
</span></code></pre><pre style="background-color:#2b303b;">
<code><span style="color:#65737e;">#!/usr/bin/env node

</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">printf </span><span style="color:#c0c5ce;">= </span><span style="color:#96b5b4;">require</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">printf</span><span style="color:#c0c5ce;">&#39;);

</span><span style="color:#b48ead;">const </span><span style="color:#c0c5ce;">{ returnValues: { </span><span style="color:#bf616a;">templateCode</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">atomCode</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">atomicNumber </span><span style="color:#c0c5ce;">} } = </span><span style="color:#bf616a;">eventResponse</span><span style="color:#c0c5ce;">;

</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">template </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">await </span><span style="color:#ebcb8b;">AppText</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">textFor</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">templateCode</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// =&gt; &quot;%1$s ist ein Element mit der Ordnungszahl %2$d!&quot;

</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">atomName </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">await </span><span style="color:#ebcb8b;">PeriodicTableText</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">textFor</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">atomCode</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// =&gt; &quot;Merkur&quot;

</span><span style="color:#bf616a;">printf</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">template</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">atomName</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">80</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// =&gt; &quot;Merkur ist ein Element mit der Ordnungszahl 80!&quot;
</span></code></pre><h3 id="unspecified-behaviour">Unspecified Behaviour</h3>
<p>This spec does not specify:</p>
<ul>
<li>Public or private access to the default <code>Localization</code></li>
<li>Who may set text
<ul>
<li>Deployer</li>
<li><code>onlyOwner</code></li>
<li>Anyone</li>
<li>Whitelisted users</li>
<li>and so on</li>
</ul>
</li>
<li>When text is set
<ul>
<li><code>constructor</code></li>
<li>Any time</li>
<li>Write to empty slots, but not overwrite existing text</li>
<li>and so on</li>
</ul>
</li>
</ul>
<p>These are intentionally left open. There are many cases for each of these, and restricting any is fully beyond the scope of this proposal.</p>
<h2 id="implementation">Implementation</h2>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">pragma solidity ^0.4.25;

contract Localization {
  mapping(bytes32 =&gt; string) private dictionary_;

  constructor() public {}

  // Currently overwrites anything
  function set(bytes32 _code, string _message) external {
    dictionary_[_code] = _message;
  }

  function textFor(bytes32 _code) external view returns (string _message) {
    return dictionary_[_code];
  }
}

contract LocalizationPreference {
  mapping(address =&gt; Localization) private registry_;
  Localization public defaultLocalization;

  bytes32 private empty_ = keccak256(abi.encodePacked(&quot;&quot;));

  constructor(Localization _defaultLocalization) public {
    defaultLocalization = _defaultLocalization;
  }

  function set(Localization _localization) external returns (bool) {
    registry_[tx.origin] = _localization;
    return true;
  }

  function get(bytes32 _code) external view returns (bool, string) {
    return get(_code, tx.origin);
  }

  // Primarily for testing
  function get(bytes32 _code, address _who) public view returns (bool, string) {
    string memory text = getLocalizationFor(_who).textFor(_code);

    if (keccak256(abi.encodePacked(text)) != empty_) {
      return (true, text);
    } else {
      return (false, defaultLocalization.textFor(_code));
    }
  }

  function getLocalizationFor(address _who) internal view returns (Localization) {
    if (Localization(registry_[_who]) == Localization(0)) {
      return Localization(defaultLocalization);
    } else {
      return Localization(registry_[tx.origin]);
    }
  }
}
</span></code></pre><h2 id="copyright">Copyright</h2>
<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>



            </div>
        </main>


        <footer class="site-footer h-card">
            <div class="wrapper">
                <h2 class="footer-heading">Ethereum Improvement Proposals</h2>
                <div class="footer-col-wrapper">
                    <div class="footer-col footer-col-1">
                        <ul class="contact-list">
                            <li class="p-name">
                                
                                GitHub User
                                
                            </li>
                            <li>
                                <a class="u-email" href="mailto:your-email@domain.com">
                                  your-email@domain.com
                                </a>
                              </li>
                            </ul>
                    </div>
                    <div class="footer-col footer-col-3">
                        <p>Description</p>
                    </div>
                </div>
            </div>
        </footer>
    </body>
</html>
